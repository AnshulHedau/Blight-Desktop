<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>Dashboard</title>
  <!-- Bootstrap core CSS-->
  <!-- Bootstrap core CSS-->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom fonts for this template-->
  <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <!-- Page level plugin CSS-->
  <link href="./vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
  <!-- Custom styles for this template-->
  <link href="./css/sb-admin.css" rel="stylesheet">
 <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>
  <script>
   // Initialize Firebase
   var config = {
     apiKey: "AIzaSyBbGWcyla5IKW8s6M7IRhne2d02QzGOYmw",
     authDomain: "blight-c675c.firebaseapp.com",
     databaseURL: "https://blight-c675c.firebaseio.com",
     projectId: "blight-c675c",
     storageBucket: "blight-c675c.appspot.com",
     messagingSenderId: "286025009005"
   };
   firebase.initializeApp(config);
  </script>
</head>

<body class="fixed-nav sticky-footer bg-dark" id="page-top">
  <!-- Navigation-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <a class="navbar-brand" href="index.html">Welcome, <span id="name"><span></a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
          <a class="nav-link" href="index.html">
            <i class="fa fa-fw fa-dashboard"></i>
            <span class="nav-link-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
          <a class="nav-link" href="./registeremp.html">
            <i class="fa fa-fw fa-dashboard"></i>
            <span class="nav-link-text">Register Workers</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
          <a class="nav-link" href="./registercar.html">
            <i class="fa fa-fw fa-dashboard"></i>
            <span class="nav-link-text">Register Vehicles</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
          <div class="nav-link" href="#">
            <i class="fa fa-fw fa-dashboard"></i>
            <span class="nav-link-text"><button type="button" onclick="loadDoc()" style="background-color: Transparent;
    background-repeat:no-repeat;color: #868e96;
    border: none;
    cursor:pointer;
    overflow: hidden;">Send Alert</button></span>
            <!--<span class="nav-link-text"><button type="button" onclick="loadDoc()">Send Alert</button></span>-->
          </div>
          
        </li>
            <script>
            function loadDoc() {
              var xhttp = new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  document.getElementById("demo").innerHTML = this.responseText;
                }
              };
              xhttp.open("GET", "http://blight-backend.herokuapp.com/check_disaster", true);
              xhttp.send();
            }
            </script>
      </ul>
    </div>
  </nav>
  <div class="content-wrapper">
    <div class="container-fluid">
      <!-- Breadcrumbs-->
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="#">Dashboard</a>
        </li>
        <li class="breadcrumb-item active">My Dashboard</li>
      </ol>
      <!-- Icon Cards-->
      <div class="row">
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-primary o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-comments"></i>
              </div>
              <div class="mr-5"><span id="usersdeployed">2</span> Users Nearby</div>
            </div>
            <!--<a class="card-footer text-white clearfix small z-1" href="#">
              <span class="float-left">View Details</span>
              <span class="float-right">
                <i class="fa fa-angle-right"></i>
              </span>
            </a>-->
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-warning o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-list"></i>
              </div>
              <div class="mr-5">0 Distress Call</div>
            </div>
            <!--<a class="card-footer text-white clearfix small z-1" href="#">
              <span class="float-left">View Details</span>
              <span class="float-right">
                <i class="fa fa-angle-right"></i>
              </span>
            </a>-->
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-success o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-shopping-cart"></i>
              </div>
              <div class="mr-5"><span id="employeedeployed">1</span> People in Center!</div>
            </div>
            <a class="card-footer text-white clearfix small z-1" href="#displayemployee">
              <span class="float-left">View Details</span>
              <span class="float-right">
                <i class="fa fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-danger o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-support"></i>
              </div>
              <div class="mr-5"><span id="vehicledeployed">1</span> Vehicle Deployed</div>
            </div>
            <a class="card-footer text-white clearfix small z-1" href="#displayvehicle">
              <span class="float-left">View Details</span>
              <span class="float-right">
                <i class="fa fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
      </div>
      <!-- Area Chart Example-->
      <div class="card mb-3">
        <div class="card-header">
          <i class="fa fa-area-chart"></i> Area Map</div>
        <div class="card-body">
       	  <iframe src="./map2.html"  width="100%" height="600px"></iframe>
          <!--<canvas id="myAreaChart"></canvas>-->
        </div>
        <div class="card-footer small text-muted">Updated at <span id="times0">11:59 PM</span></div>
      </div>
      
          
      <!-- Example DataTables Card-->
      <div class="card mb-3" id="displayemployee">
        <div class="card-header">
          <i class="fa fa-table"></i> Employee Table</div>
        <div class="card-body">
          <div class="table-responsive">
            <div id="employeetable"></div>
            </table>
          </div>
        </div>
        <div class="card-footer small text-muted">Updated at <span id="times1">11:59 PM</span></div>
      </div>
      <div class="card mb-3" id="displayvehicle">
        <div class="card-header">
          <i class="fa fa-table"></i> Vehicle Table</div>
        <div class="card-body">
          <div class="table-responsive">
            
              <div id="vehicletable">
              </div>
              
            
          </div>
        </div>
        <div class="card-footer small text-muted">Updated at <span id="times2">11:59 PM</span></div>
      </div>
    </div>
    <!-- /.container-fluid-->
    <!-- /.content-wrapper-->
    <footer class="sticky-footer">
      <div class="container">
        <div class="text-center">
          <small>Copyright © Blight 2018</small>
        </div>
      </div>
    </footer>
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fa fa-angle-up"></i>
    </a>
    <!-- Logout Modal-->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
          <div class="modal-footer">
            <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
            <a class="btn btn-primary" href="login.html">Logout</a>
          </div>
        </div>
      </div>
    </div>
    <div id='outputDiv'></div>
    <script type="text/javascript">
      
          var url_string = window.location.href;
          var url = new URL(url_string);
          var c = url.searchParams.get("userId");
          console.log(c);
          //var userId = firebase.auth().currentUser.uid;
          //console.log(userId);
          //return 
          firebase.database().ref('rescueworkers/' + c).once('value').then(function(snapshot) {
            var username = (snapshot.val() && snapshot.val().username) ;
            var password = (snapshot.val() && snapshot.val().pass) ;
            var email = (snapshot.val() && snapshot.val().email) ;
            /*var address = (snapshot.val() && snapshot.val().address) ;
            var region = (snapshot.val() && snapshot.val().region) ;
            var contact = (snapshot.val() && snapshot.val().contact) ;*/

            document.getElementById("name").innerHTML =username;
            console.log(username,password,email);//,address,region,contact);
            console.log("yes");
          });


          var groupRef = firebase.database().ref('users/').once('value').then(function(snapshot) {
            var key_num_users  = snapshot.numChildren();//.(snapshot.key);
            document.getElementById("usersdeployed").innerHTML = key_num_users;

          });


          firebase.database().ref('employee/').once('value').then(function(snapshot) {
            var name = (snapshot.val());// && snapshot.val().name) ;
            
            var key_num_emp = snapshot.numChildren();//.(snapshot.key);
            document.getElementById("employeedeployed").innerHTML = key_num_emp;
            var scre = "<table class='table table-bordered' id='dataTable' width='100%'cellspacing='0'><thead><tr><th>Employee Number</th></tr></thead><tbody>";
            for(i = 0; i < key_num_emp; i++){
              var key_first = Object.keys(snapshot.val())[i];
              scre += "<tr><td>"+key_first+"</td></tr>";
              console.log("CHECK" + Object.keys(snapshot.val())[i]);
                var employeeRef = firebase.database().ref("employee/" + key_first);
                employeeRef.once('value').then(function (snapshot) {
                   console.log("ADDRESS : " + snapshot.val().address); 
                });
            }
            scre +=  "</tbody></table>";
            document.getElementById("employeetable").innerHTML += scre;
            console.log(scre);

          });

          var groupRef = firebase.database().ref('vehicles/').once('value').then(function(snapshot) {
            var data = (snapshot.val());// && snapshot.val().name) ;
            //var salary = (snapshot.val() && snapshot.val().salary) ;
            console.log(data);
            
            var key_num  = snapshot.numChildren();//.(snapshot.key);
            document.getElementById("vehicledeployed").innerHTML = key_num;
            var scr = "<table class='table table-bordered' id='dataTable' width='100%'cellspacing='0'><thead><tr><th>Registration Number</th></tr></thead><tbody>";
            for(i = 0; i < key_num; i++){
              var key_first = Object.keys(snapshot.val())[i];
              scr += "<tr><td>"+key_first+"</td></tr>";
              //console.log(Object.keys(snapshot.val())[i];);
            }
            scr +=  "</tbody></table>";
            document.getElementById("vehicletable").innerHTML += scr;
            console.log(scr);
            var d = new Date();
              var n = d.toLocaleTimeString();
              console.log(n);
              document.getElementById("times0").innerHTML = n;
              document.getElementById("times1").innerHTML = n;
              document.getElementById("times2").innerHTML = n;
          });



          
          
    </script>
    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <!-- Page level plugin JavaScript-->
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/datatables/jquery.dataTables.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.js"></script>
    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin.min.js"></script>
    <!-- Custom scripts for this page-->
    <script src="js/sb-admin-datatables.min.js"></script>
    <script src="js/sb-admin-charts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
  </div>
</body>

</html>
